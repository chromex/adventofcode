import aoc

input = """.........#...................................................................................................#.................#..
...........................#.......................................#..............................................................
.............#.................................................................................#............................#.....
...#.....................#.......#....................................#..............#.............................#...........#.#
..........#.....#..#.....#.............#..................#............#.....#........#.#.......#............................#....
...#...................#..........#...................#.........#..#..............##.......................................#......
..................................................................................................#...............................
...............#.........#....#.#..#.........#...........#...#....................#.........#.......#....#........................
..........................................#......#.#...................................................#.............#............
....................#............................#..........................................#.....................#.........#.....
..............#..................................#................#..#...........................................#................
.........#....###.......#........................................................................................#.#.....#...#..#.
.#....................................#.....................................#.................................#..................#
........................#...................................#.#....................#......##.#.........#..........................
............#.......#..................#..........................................................................................
....#.............#.#.....#...#.....#......................#...............#............##...#....................................
...#....#.....................................##........#........#....##.....................................#....................
...........................................................................#........#..........##................................#
..............................#.#......................#..........................#..#........#...............................#...
..............#.........###.......................................#...........#...............#......#.........#........#.....#...
............#............................#....................#........................#............#.............................
.........................................#.....................................................#.....#...............#............
.#...##.......................#.......#..........................................................................#...#...........#
....#..............#............#......#........................#.......................#...#.......................#.............
.......#...............#......#......#..........................................#..................#....................#...#.....
.......................................................................#.........#................................................
.#.......#........................................................##..............................................................
.........................#...................#..#......##..................................#......#......#........................
......................................#..............................................#......#..........#.#.........#..............
.....#..............#..#........#..............................#...##.............................................................
..##............................#.......................................................#..........#..............................
...........................................................##................................................#....................
#...............#.........#.....................................................#......................###........................
#.#.......................#........................#..#.....................#....#........#........................#...#.........#
............#.............#.#............#........................#..........#....................................................
............#...................#.....................................................................................#.......#...
.............................#...#..#...........................#...#.........................................................#...
........#.......................##..........................................................#.........#.....................#.....
............##............#..........................................................#.#.....#......#.#.......#...................
...........#.....#......#.................#.............#......................................#.....#...#........................
#............#.........#.......##.....#......#...........#...........#.......#................#...................................
......#..#...#.....#................................................#............#...#..........^.................................
............................................................................................................#....#................
......................................#.............................#........................#...............#.....#...#..........
...#.........................................................................#....................................................
.....................................#.........................................................#.............#.........#..........
#..............................#...#.................................#............................................................
..........#..................#............#.......#...........................#...................#.....#.........................
............................#...##.............................................................#............#.....................
.................#..................................................................#..#..............#...........................
..................#...............................#................#............#...........#......#............#.................
.....#......................#..............#.......................#......................#.......................................
...............................#.....#.......................#.......#......................#......#............#...........#.....
......#.............##....#.....#...............#.....#............................#....................................#.........
...#.#.......#..#...##.............................................................#.#.#...........#.....#................#.......
...........................................#...#......#...........................................................................
.........#.................................#........................................................................#........#.#..
........................#..........................................#.......#..............#.......................................
....................................................#...............#..........................#..................................
............................#................#......#...............#.....................#.......................................
#.#............#......................................................................................#.....#.....................
................................................................#....#..........................................#........#......#.
.......#........#......................................................................#.................#..................#.#...
...............................#...#......................................................................#.........#.........#...
...........#..#..................##..#.........................................#..............##............................#.....
#........#...............#.....#.....#.................#............#....#.............................#.......#.................#
...............#...................................................#.......#.......................#......#.............#.........
...#............................................................................................................................#.
#.....................#......................................................#...........................................#........
...........#..........................................#.......................................#.....................#.............
....#.##.......#..............#.....#..............................#....................................#.....................#...
...............................................................................................................#...............#..
.#...........................#...#.....#...#...................#....#........#.........#................................#.........
.................#............................................................................#........................#..#.......
.............#....#.....................................................#............#.........................#.......#..........
#....#........................#....................................................................##.............................
...#.#.....................................#...............................................#.....................#....#.........#.
.........#..............................#....................................#.................#............#.....................
................................................................#.................................................................
#.......#..............................................#.............................#...........#................................
.#......#.........#.............................#...............................................................#.................
.........#.....#......#.......................................................................................................#...
#..............................#........#............................#.................................#.....#.....#..............
......#.....................................#.......#........#....................................................................
#.......#.....................................#......................................................................#............
.....................................#......................................#......#.##..................#.....#.#................
.......................#.........#......#...........................................................................##............
.....#......#.#.................................................#.............................#............#.#.......#............
..................#.......................................#.#.............................#..................................#....
......................#.......#.....................#...................#......#.........................................#........
.........#...................................................................................................#....#...............
.........................#...........#..........#...............#.....#...................................................##......
#...#......#.#.....................#..................#.................#..................#......................................
..............................#.....#................#.....................#............#...#....#............#...#...............
.........................#..................#.............................................................................#.......
.......#....................#.......................#.....................#..........#...........#..........#...................#.
....#..........#..#................#.....#..........#........#..................#.....................##...............#.........#
.....................................................................................#......................................#.....
.......................................#...................................#.......................#..........................#...
.......#...............................#............#.....#..............................................#.................#......
.#..........................#..................................................................#...#.#.......#.#..........#.......
#...............................................................#.#............................#...............#......#...........
...#..........................#.#..#.#.............................................................#......#.......................
..................#........#.....................................................#...............................................#
....................#.............#.........#........##................#.............#............#..#............................
.........................#.................................#...........................................#.....#....................
..........................................##..........#................................#........................................#.
.................................................................................#..........#....................##........##.....
.....###......#.....#...................................................................................#..#...................#..
........#.....#.....#.....#..........#.................................................#.#......................#.................
...........................................#....#..............#..#..............#................................................
....#.............#...................................#.....#........................................................#............
.........#........#.............#..................#..........#..........................###.......#....#.#.#.....................
..................#....................#...................#...#..................................................................
.......#...............#................................................................................#................#........
....#..........................#......#....................................#.............#...#......................#...#.........
.#..#....................#.....................#.............#...............................#....................#....##.........
..#..#........#......#.................##..#.......#....................#.............................................#...........
..................#......#.............#.##.................................##.....................................#...#..........
.#...##........#........................................................................................#.....#...#....#..........
............#........................#............................................#.........#.............#.......................
................#......#........#...........................................................#............#........................
..............................#.#......#................................#...........#......................................#......
...................#...................#.............#............#.............#.................................................
.........#.......#....#........#.........#.....................#..#.......#..#...#.............................#..................
.........#...#.........................................................................#.....#.......#............................
.........................#..........#...............................................#.....................................#....#..
....#..................##..##...........#.........#..................................................#...#...........#...........#
.......#.......#.....#...............#.#.....#.............#........................#..............................#..#.........#.
........................#........................................#.............................##................................."""

map = aoc.DM2(input)

sdir = aoc.Direction.UP
sx = 0
sy = 0
def SetPos(_, _x, _y):
    global sx, sy
    sx = _x
    sy = _y
map.Filter(lambda x: x == "^", SetPos)

def Travel(map):
    x = sx
    y = sy
    dir = sdir

    hist = set()

    while True:
        key = f"{x} {y} {dir}"

        if key in hist:
            return True
        else:
            hist.add(key)

        nx, ny = aoc.Direction.MovePos(x, y, dir)
        
        if not map.IndexInBounds(nx, ny):
            return False
        
        if map[nx, ny] == "#":
            dir = aoc.Direction.TurnRight(dir)
        else:
            x = nx
            y = ny

sum = 0
def Test(x, y):
    global sum
    if x == sx and y == sy:
        return
    
    if map[x, y] == "#":
        return

    cpy = aoc.DataMatrix(input)
    cpy.Set(x, y, "#")
    if Travel(cpy):
        sum += 1

map.VisitAll(Test)

print(sum)